{% extends "user-admin.html" %}

{% load patient%}
{% block 'content' %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

  <div class="container d-flex justify-content-center align-items-center h-100 w-100 " 
  style="background-color:transparent ;">
                 
    {% if messages%}                  
    {% for message in messages %}
    {% if message.tags == 'error'%}
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            var m="{{message}}";
            console.log(m);
            Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: m,
                    showConfirmButton: false,
                    timer: 4000
                    })
           </script>
           {%endif%}
    {% if message.tags == 'success'%}
           <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
           <script>
               var m="{{message}}";
               console.log(m);
               Swal.fire({
                       position: 'center',
                       icon: 'success',
                       title: m,
                       showConfirmButton: false,
                       timer: 4500
                       })
              </script>
              {%endif%}       
{% endfor %}
{%endif%} 
    <div class="card p-3 pl-5  " style="width: 90%; height: 95%; background-color: transparent;border: none;">
      <div class="card-title shadow-lg p-2 bg-transBody rounded d-flex justify-content-between">
        <h3 class=" pl-2">ORDER HISTORY</h3>
        <a href="{% url 'patient:ord' %}" class="btn btn-warning rounded-3 float-right px-2">my order</a>
      </div>
    <div class="row"> 
        <div class="col-lg-6  mt-3">
                {% for i in order_list%}
                 <div class="card mt-2  p-3 text-white bg-transBody">
                   <table>
                     <tbody>
                      <tr>
                        <td class="d-flex justify-content-around">
                          <div>
                            <h6>Bill number</h6>
                            <h6>Order date</h6>
                            <h6>Product name</h6>
                            <h6>Product Quantity</h6>
                            <h6>Amount</h6>
                            <h6>Payment Type</h6>
                            <h6>order status</h6>
                         </div>
                         <div>
                            <h6>#{{i.id}}{{i.order_date.day}}{{i.order_date.year}}</h6>
                            <h6>{{i.order_date}}</h6>
                            {% if i.order_items.exists %}
                                <h6>{{ i.order_items.first.product }}</h6>
                                <h6>{{ i.order_items.first.quantity }}</h6>
                            {% endif %}
                            <h6>{{i.Total_Price}}</h6>
                            <h6>{{i.Pay_option}}</h6>                      
                            <h6>{{i.status}}</h6>
                         </div>    
                          <!-- #{{i.id}}{{i.order_date.day}}{{i.order_date.year}}<br>
                          {{i.order_date}}<br>
                          {% for j in i.order_items.all%}              
                             {{j.product}} {{j.quantity}}
                          {%endfor%}
                          <br>
                          {{i.Total_Price}}<br>
                          {{i.Pay_option}}<br>                      
                          {{i.status}}
                        </td> -->
                        <td>
                          {% for j in i.order_items.all%}              
                            <img src="{{j.product.image.url}}" width="100px" height="100px"> 
                          {%endfor%}
                        </td>
                      </tr>
                     </tbody>
                   </table>
                    
                     <div class="text-center">
                    {% if i.order_refund.all %}
                        {% for k in i.order_refund.all %}
                          {% if k.status == "completed" %} 
                             <a class="btn btn-primary">Return completed</a>
                          {% elif k.status == "cancel" %}
                             <a class="btn text-danger">Return Revoked</a>                          
                          {% else%} 
                             <a class="btn btn-warning w-50" >Return {{k.status}}</a>
                          {%endif%}   
                        {%endfor%}          
                    {%else%}
                      {% if i.order_date.date|expaire %}
                         <a class="return  btn btn-danger bg-danger" data-item-id="{{i.id}}" value="{{ i.id }}">return</a> 
                         <!-- <a href="#" class="btn btn-primary">Return</a> -->
                         <a href="{% url 'patient:invoice' i.id %}" class="btn btn-info">Invoice</a>   
                      {%else%}
                         <a href="{% url 'patient:invoice' i.id %}" class="btn btn-info">Invoice</a>   
                      {%endif%}
                    {%endif%}  
                      </div>
                 </div>
                {%endfor%} 
        </div>
    </div>  
  </div>
  <div class="modal fade" id="deleteModal3" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
      <form action="{% url 'patient:cancel_order' %}" method="post">
        {% csrf_token %} 
          <div class="modal-header text-center">
            <h4 class="modal-title text-dark w-100" id="deleteModalLabel">RETURN ORDER</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body ">
              <input type="hidden" name="dele" id="userdel_id"  value="">
              <h6 class="text-center text-dark">Are you really want to return the order</h6>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger" id="confirmDelete">Yes</button>
          </div>
      </form>  
      </div>
    </div>
</div>
<script>
  $(document).ready(function(){                  
  $('.return').click(function(e){
    e.preventDefault();
    var id = $(this).attr("value");
    // id = $(".delete-button").attr("value");
    console.log(id);
    $('#userdel_id').val(id);
    $('#deleteModal3').modal('show');
  });
});
</script>     
  </div>              


{%endblock%}